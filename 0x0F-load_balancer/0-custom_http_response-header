#!/usr/bin/env bash
# Installs Nginx with the following configurations:
#+    Listens on port 80.
#+    Returns a page containing "Holberton School" when queried
#+     at the root with a curl GET request.
#+    Configures /redirect_me as a "301 Moved Permanently".
#+    Includes a custom 404 page containing "Ceci n'est pas une page".
#+    Contains a custom HTTP header named X-Served-By.
#+    The value of the HTTP header is the hostname of the running server.

#!/bin/bash

# Update the package repository and install Nginx
if ! command -v nginx &>/dev/null; then
	sudo apt-get update
	sudo apt-get install -y nginx
fi

# Define the custom header name
custom_header_name="X-Served-By"

# Get the hostname of the server
server_hostname="$(hostname)"

# Create an Nginx configuration file for the custom header
echo "server {
    listen 80 default_server;
    listen [::]:80 default_server;

    server_name _;

    location / {
        add_header X-Served-By $custom_header_name;
        root /var/www/html;
        index index.html;
    }
}" | sudo tee /etc/nginx/sites-available/custom_header

# Create a symbolic link to enable the configuration
if [ ! -e /etc/nginx/sites-enabled/custom_header ]; then
    sudo ln -s /etc/nginx/sites-available/custom_header /etc/nginx/sites-enabled/
fi

# Remove the default Nginx configuration (if needed)
sudo rm -f /etc/nginx/sites-enabled/default

# Test Nginx configuration for syntax errors
sudo nginx -t

# Reload Nginx to apply the changes
sudo systemctl reload nginx

# Exit the script
exit 0
